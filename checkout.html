<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./assets/css/input.css" rel="stylesheet" />
    <link href="./assets/css/output.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <title>Checkout - SOLAR PRODUCT SALES</title>
    <style>
      @media (min-width: 768px) {
        .grid-template-columns {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>

  <body class="max-w-[1280px] mx-auto">
    <header
      class="top-0 left-0 sticky padding-inline flex items-center py-3 justify-between w-full bg-[#002347] md:border-b-0.5 border-custom-blue backdrop-blur-61.5"
    >
      <a href="/">
        <img src="./assets/images/logo.png" class="w-[126px] h-12" alt="logo" />
      </a>
      <button
        id="menu-toggle"
        class="text-white md:hidden focus:outline-none focus:ring-2 focus:ring-orange-500"
        aria-expanded="false"
        aria-controls="menu-mobile"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          />
        </svg>
      </button>
      <nav id="menu" class="hidden md:flex relative">
        <ul class="text-white flex flex-row gap-8">
          <li><a href="/" class="text-sm font-normal">Home</a></li>
          <li>
            <a href="/about.html" class="text-[12px] font-normal">About us</a>
          </li>
          <li>
            <a href="#" class="text-orange text-[12px] font-normal">Service</a>
          </li>
          <li>
            <a href="#contact" class="text-[12px] font-normal">Contact</a>
          </li>
        </ul>
        <span
          id="cart-count"
          class="absolute -top-2 -right-4 bg-orange text-blue rounded-full w-5 h-5 flex items-center justify-center text-xs"
          >0</span
        >
      </nav>
      <nav
        id="menu-mobile"
        class="hidden fixed top-0 left-0 w-full h-full bg-gray-900 bg-opacity-90 z-50 flex flex-col items-center justify-center"
      >
        <ul class="text-white justify-center items-center flex flex-col gap-6">
          <li><a href="/" class="text-lg font-medium">Home</a></li>
          <li>
            <a href="/about.html" class="text-lg font-medium">About us</a>
          </li>
          <li>
            <a href="#" class="text-orange text-lg font-medium">Service</a>
          </li>
          <li><a href="#contact" class="text-lg font-medium">Contact</a></li>
        </ul>
        <button
          id="close-menu"
          class="absolute top-6 right-6 text-white text-2xl focus:outline-none"
          aria-label="Close menu"
        >
          ×
        </button>
      </nav>
    </header>

    <section class="padding-inline py-10">
      <h2 class="text-white text-3xl font-bold mb-6">Checkout</h2>
      <div class="grid grid-cols-1 grid-template-columns gap-10">
        <div class="text-white">
          <h3 class="text-xl font-semibold mb-4">Order Summary</h3>
          <div id="cart-items" class="flex flex-col gap-4"></div>
          <p class="text-lg font-semibold mt-4">
            Total: <span id="total-price">₦0</span>
          </p>
        </div>
        <div class="text-white">
          <h3 class="text-xl font-semibold mb-4">Shipping Information</h3>
          <form id="checkout-form" class="flex flex-col gap-4">
            <input
              type="text"
              id="name"
              placeholder="Full Name"
              class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
              required
            />
            <input
              type="email"
              id="email"
              placeholder="Email"
              class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
              required
            />
            <input
              type="tel"
              id="phone"
              placeholder="Phone Number"
              class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
              required
            />
            <textarea
              id="address"
              placeholder="Address"
              class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
              rows="4"
              required
            ></textarea>
            <button
              type="submit"
              class="w-full p-3 rounded bg-[#FBB610] text-blue font-semibold"
            >
              Place Order
            </button>
          </form>
          <p id="form-message" class="mt-2 text-center"></p>
        </div>
      </div>
    </section>

    <div
      id="loading"
      class="fixed inset-0 bg-[#002347] flex items-center justify-center z-50"
    >
      <div
        class="animate-spin rounded-full h-12 w-12 border-t-4 border-[#FBB610]"
      ></div>
      <p class="text-white text-lg ml-4">Loading...</p>
    </div>

    <footer class="padding-inline flex flex-col gap-6 md:gap-12 pt-10 mb-8">
      <img src="./assets/images/logo.png" class="w-24 md:w-32" alt="" />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <div class="text-white gap-5 flex flex-col">
          <div class="flex flex-col gap-4">
            <h4 class="font-semibold text-[16px] md:text-[20px]">
              Contact Info
            </h4>
            <p class="font-normal text-[12px] md:text-[16px]">
              You can get in touch with us on any of there platforms
            </p>
          </div>
          <div class="flex flex-col gap-4">
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-facebook-square"
              ></i>
              <span>Facebook: Power from the other side</span>
            </p>
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-instagram-alt"
              ></i>
              <span>Instagram: @pfos_Solar</span>
            </p>
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-whatsapp-square"
              ></i>
              <span>WhatsApp: +234 903 276 9065</span>
            </p>
          </div>
        </div>
        <div class="text-white gap-3 flex flex-col">
          <h4 class="font-semibold text-lg md:text-xl text-white">
            Send Quick Message
          </h4>
          <form
            id="contact-form"
            action=""
            method="post"
            class="flex flex-col gap-3"
          >
            <div class="flex flex-col md:flex-row gap-3">
              <div class="mb-4">
                <input
                  type="text"
                  name="name"
                  id="name-contact"
                  placeholder="Name"
                  class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
                />
              </div>
              <div class="mb-4">
                <input
                  type="email"
                  name="email"
                  id="email-contact"
                  placeholder="Email"
                  class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
                />
              </div>
            </div>
            <div class="mb-4">
              <textarea
                name="message"
                id="message-contact"
                placeholder="Message"
                class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
                rows="4"
              ></textarea>
            </div>
            <button
              type="submit"
              class="w-full p-3 rounded bg-[#B0CFEF] text-blue font-semibold hover:bg-blue-700"
            >
              SEND
            </button>
          </form>
        </div>
      </div>
    </footer>
    <section
      class="bg-[#011B36] w-full py-8 padding-inline flex justify-center md:justify-end"
    >
      <p class="text-white text-xs md:text-sm">
        PFDOS Enterprise RC: 3334515 C 2020. All Rights Reserved
      </p>
    </section>

    <script>
      window.onload = function () {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        if (cart.length === 0) {
          window.location.href = "/";
          return;
        }
        updateCartCount();
        displayCartItems(cart);
      };

      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce(
          (sum, item) => sum + (item.quantity || 1),
          0
        );
        document.getElementById("cart-count").textContent = totalItems;
      }

      function displayCartItems(cart) {
        const cartItemsDiv = document.getElementById("cart-items");
        let totalPrice = 0;
        cartItemsDiv.innerHTML = "";
        cart.forEach((item) => {
          const itemTotal = item.price * (item.quantity || 1);
          totalPrice += itemTotal;
          cartItemsDiv.innerHTML += `
            <div class="flex justify-between">
              <p>${item.name} (x${item.quantity || 1})</p>
              <p>₦${itemTotal}</p>
            </div>
          `;
        });
        document.getElementById("total-price").textContent = `₦${totalPrice}`;
      }

      document
        .getElementById("checkout-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const messageEl = document.getElementById("form-message");
          messageEl.textContent = "Placing order...";
          messageEl.style.color = "white";

          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const phone = document.getElementById("phone").value;
          const address = document.getElementById("address").value;
          const cart = JSON.parse(localStorage.getItem("cart")) || [];
          const totalPrice = cart.reduce(
            (sum, item) => sum + item.price * (item.quantity || 1),
            0
          );

          const orderData = { name, email, phone, address, cart, totalPrice };

          console.log("Sending order data:", orderData);

          try {
            const response = await fetch(
              "https://pfos-backend.vercel.app/api/order",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(orderData),
              }
            );

            console.log("Response status:", response.status);
            const text = await response.text();
            console.log("Raw response:", text);

            let result;
            try {
              result = JSON.parse(text);
            } catch (jsonError) {
              throw new Error(`Invalid JSON response: ${text}`);
            }

            console.log("Parsed server response:", result);

            if (response.ok) {
              messageEl.textContent =
                result.message || "Order placed successfully!";
              messageEl.style.color = "green";
              localStorage.removeItem("cart");
              updateCartCount();
              setTimeout(
                () => (window.location.href = "/?order=success"),
                2000
              );
            } else {
              messageEl.textContent = `Error: ${
                result.error || "Failed to place order"
              }`;
              messageEl.style.color = "red";
            }
          } catch (error) {
            messageEl.textContent = `Error: ${error.message}`;
            messageEl.style.color = "red";
            console.error("Fetch error:", error);
          }
        });
    </script>

    <script src="./assets/js/script.js"></script>
  </body>
</html>
,
