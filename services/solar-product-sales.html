<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../assets/css/output.css" rel="stylesheet" />
    <link href="../assets/css/input.css" rel="stylesheet" />
    <title>SOLAR PRODUCT SALES</title>
  </head>

  <body class="max-w-[1280px] mx-auto">
    <!-- Start Header -->
    <header
      class="top-0 left-0 sticky padding-inline flex items-center py-3 justify-between w-full bg-[#002347] md:border-b-0.5 border-custom-blue backdrop-blur-61.5"
    >
      <a href="/">
        <img
          src="../assets/images/logo.png"
          class="w-[126px] h-12"
          alt="logo"
        />
      </a>
      <button
        id="menu-toggle"
        class="text-white md:hidden focus:outline-none focus:ring-2 focus:ring-orange-500"
        aria-expanded="false"
        aria-controls="menu-mobile"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          />
        </svg>
      </button>
      <nav id="menu" class="hidden md:flex">
        <ul class="text-white flex flex-row gap-8">
          <li><a href="/" class="text-sm font-normal">Home</a></li>
          <li>
            <a href="/about.html" class="text-[12px] font-normal">About us</a>
          </li>
          <li>
            <a href="#" class="text-orange text-[12px] font-normal">Service</a>
          </li>
          <li>
            <a href="#contact" class="text-[12px] font-normal">Contact</a>
          </li>
        </ul>
      </nav>
      <!-- Add Cart Icon and Count -->
      <div id="cart-nav" class="text-white flex items-center gap-2">
        <i class="bx bx-cart"></i>
        <span id="cart-count">0</span>
      </div>
      <!-- Mobile Menu -->
      <nav
        id="menu-mobile"
        class="hidden fixed top-0 left-0 w-full h-full bg-gray-900 bg-opacity-90 z-50 flex flex-col items-center justify-center"
      >
        <ul class="text-white justify-center items-center flex flex-col gap-6">
          <li><a href="/" class="text-lg font-medium">Home</a></li>
          <li>
            <a href="/about.html" class="text-lg font-medium">About us</a>
          </li>
          <li>
            <a href="#" class="text-orange text-lg font-medium">Service</a>
          </li>
          <li><a href="#contact" class="text-lg font-medium">Contact</a></li>
        </ul>
        <button
          id="close-menu"
          class="absolute top-6 right-6 text-white text-2xl focus:outline-none"
          aria-label="Close menu"
        >
          Ã—
        </button>
      </nav>
    </header>
    <!-- end Header -->

    <!-- Hero Section -->
    <main
      class="padding-inline py-20 hero-section"
      style="
        background-image: url('../assets/images/HEROSECTION.svg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      "
    >
      <!-- hero left -->
      <div class="flex items-center justify-center flex-col gap-4">
        <h1 class="text-white text-4xl md:text-[75px] font-bold">SERVICES</h1>
        <p
          class="text-white text-[28px] md:text-[32px] text-center font-semibold"
        >
          SOLAR PRODUCT SALES
        </p>
      </div>
    </main>
    <!--End Hero Section -->

    <!-- About Section -->
    <section class="mt-10 padding-inline pt-[58px] pb-[82px]">
      <div
        class="flex gap-10 items-center flex-col md:items-stretch md:flex-row w-full"
      >
        <!-- about left -->
        <div class="md:w-[50%]">
          <img
            src="../assets/images/solor.png"
            alt=""
            class="w-[300px] md:w-[500px] :h-[350px] md:h-[372px]"
          />
        </div>
        <!-- about left -->
        <div class="flex flex-col justify-center gap-6 md:w-[50%] text-white">
          <h4 class="font-semibold text-[28px] md:text-[32px]">
            SOLAR PRODUCT SALES
          </h4>
          <p class="text-[14px] md:text-[16px]">
            You can conveniently purchase all our solar products directly from
            this website. From high-quality panels and inverters to complete
            solar kits, our online store offers everything you need to start
            your solar journey. With secure payment options and fast delivery,
            going solar has never been easier!
          </p>
        </div>
      </div>
    </section>
    <!-- About Section End-->

    <!-- Product Section -->
    <section
      class="padding-inline py-[77px] bg-[#E6F0FA] flex flex-col items-center gap-10"
    >
      <div class="flex flex-col items-center gap-3 text-blue">
        <div class="flex items-center gap-6">
          <p class="bg-orange h-[2px] w-[60px] md:w-[80px]"></p>
          <span class="font-normal text-sm md:text-xl">OUR PRODUCTS</span>
        </div>
        <h2 class="font-semibold text-[36px] md:text-[52px]">
          GET AFFORDABLE SOLAR PRODUCTS
        </h2>
        <p class="text-[12px] md:text-[16px]">
          We are fortunate to have formed excellent partnership with many of our
          clients.
        </p>
      </div>

      <div
        id="loading"
        class="fixed inset-0 bg-[#002347] flex items-center justify-center z-50"
      >
        <div
          class="animate-spin rounded-full h-12 w-12 border-t-4 border-[#FBB610]"
        ></div>
        <p class="text-white text-lg ml-4">Loading...</p>
      </div>

      <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-[20px] items-center justify-center"
        id="product-container"
      ></div>
    </section>
    <!-- End Product Section -->

    <!-- Footer -->
    <footer class="padding-inline flex flex-col gap-6 md:gap-12 pt-10 mb-8">
      <img src="../assets/images/logo.png" class="w-24 md:w-32" alt="" />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <div class="text-white gap-5 flex flex-col">
          <div class="flex flex-col gap-4">
            <h4 class="font-semibold text-[16px] md:text-[20px]">
              Contact Info
            </h4>
            <p class="font-normal text-[12px] md:text-[16px]">
              You can get in touch with us on any of there platforms
            </p>
          </div>
          <div class="flex flex-col gap-4">
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-facebook-square"
              ></i>
              <span>Facebook: Power from the other side</span>
            </p>
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-instagram-alt"
              ></i>
              <span>Instagram: @pfos_Solar</span>
            </p>
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-whatsapp-square"
              ></i>
              <span>WhatsApp: +234 903 276 9065</span>
            </p>
          </div>
        </div>
        <div class="text-white gap-3 flex flex-col">
          <h4 class="font-semibold text-lg md:text-xl text-white">
            Send Quick Message
          </h4>
          <form action="" method="post" class="flex flex-col gap-3">
            <div class="flex flex-col md:flex-row gap-3">
              <div class="mb-4">
                <input
                  type="text"
                  name="name"
                  id="name"
                  placeholder="Name"
                  class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF] focus:bg-[#011B36] focus:border-[#B0CFEF] focus:text-white focus:outline-none focus:ring-0 focus:ring-[#B0CFEF]"
                />
              </div>
              <div class="mb-4">
                <input
                  type="email"
                  name="email"
                  id="email"
                  placeholder="Email"
                  class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF] focus:bg-[#011B36] focus:border-[#B0CFEF] focus:text-white focus:outline-none focus:ring-0 focus:ring-[#B0CFEF]"
                />
              </div>
            </div>
            <div class="mb-4">
              <textarea
                name="message"
                id="message"
                placeholder="Message"
                class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF] focus:bg-[#011B36] focus:border-[#B0CFEF] focus:text-white focus:outline-none focus:ring-0 focus:ring-[#B0CFEF]"
                rows="4"
              ></textarea>
            </div>
            <button
              type="submit"
              class="w-full p-3 rounded bg-[#B0CFEF] text-blue font-semibold hover:bg-blue-700"
            >
              SEND
            </button>
          </form>
        </div>
      </div>
    </footer>
    <!-- End Footer -->

    <section
      class="bg-[#011B36] w-full py-8 padding-inline flex justify-center md:justify-end"
    >
      <p class="text-white text-xs md:text-sm">
        PFDOS Enterprise RC: 3334515 C 2020. All Rights Reserved
      </p>
    </section>

    <div id="floating-cart" class="fixed bottom-4 right-4 z-50">
      <button
        id="cart-toggle"
        class="bg-[#FBB610] text-[#002347] rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:bg-[#e0a009] transition-colors"
      >
        <i class="bx bx-cart text-xl"></i>
        <span
          id="floating-cart-count"
          class="absolute -top-2 -right-2 bg-[#002347] text-white rounded-full w-6 h-6 flex items-center justify-center text-xs"
          >0</span
        >
      </button>
      <div
        id="cart-dropdown"
        class="hidden absolute bottom-16 right-0 bg-[#002347] border border-[#B0CFEF] rounded-lg shadow-lg w-64 p-4"
      >
        <h4 class="text-white font-semibold mb-2">Your Cart</h4>
        <div
          id="cart-preview"
          class="flex flex-col gap-2 max-h-48 overflow-y-auto"
        ></div>
        <p class="text-white font-semibold mt-2">
          Total: <span id="cart-total">â‚¦0</span>
        </p>
        <a
          href="/checkout.html"
          class="block mt-2 w-full py-2 text-center rounded bg-[#FBB610] text-[#002347] font-semibold hover:bg-[#e0a009] transition-colors"
          >Checkout</a
        >
      </div>
    </div>
    <script type="text/javascript">
      document
        .getElementById("quickMessageForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const name = document.getElementById("name").value.trim();
          const email = document.getElementById("email").value.trim();
          const message = document.getElementById("message").value.trim();

          // Function to show notification
          const showNotification = (message, isSuccess = true) => {
            const notification = document.getElementById("form-notification");
            if (!notification) {
              console.error("Notification element not found.");
              return;
            }
            notification.textContent = message;
            notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg transition-opacity duration-300 ${
              isSuccess ? "bg-green-500 text-white" : "bg-red-500 text-white"
            }`;
            notification.classList.remove("hidden");
            notification.classList.add("show");
            setTimeout(() => {
              notification.classList.remove("show");
              notification.classList.add("hidden");
            }, 3000); // Hide after 3 seconds
          };

          if (!name || !email || !message) {
            showNotification("All fields are required!", false);
            return;
          }

          try {
            const response = await fetch(
              "https://pfos-backend.vercel.app/api/messages",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ name, email, message }),
              }
            );

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.error || "Failed to send message");
            }

            showNotification("Message sent successfully!");
            document.getElementById("quickMessageForm").reset();
          } catch (error) {
            showNotification(
              "Failed to send message. Please try again.",
              false
            );
            console.error("Error:", error);
          }
        });
    </script>
    <script>
      const API_BASE_URL = "https://pfos-backend.vercel.app";
      async function fetchProducts() {
        document.getElementById("loading").style.display = "flex";
        try {
          // Check for order success query parameter
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.get("order") === "success") {
            document.getElementById("product-container").innerHTML = `
          <div class="text-center py-16">
            <h2 class="text-white text-3xl md:text-4xl font-bold mb-4">Order Received!</h2>
            <p class="text-white text-lg md:text-xl mb-6">Your order has been received, and a generated invoice will be sent to your email shortly.</p>
            <a href="/" class="inline-block py-3 px-6 rounded bg-[#FBB610] text-[#002347] font-semibold hover:bg-[#e0a009] transition-colors">Return to Home</a>
          </div>
        `;
            history.replaceState(null, "", "/");
            return;
          }

          const response = await fetch(`${API_BASE_URL}/api/products`, {
            cache: "no-store",
          });
          const products = await response.json();
          console.log(
            "Raw products from API:",
            JSON.stringify(products, null, 2)
          );
          if (!Array.isArray(products) || products.length === 0) {
            document.getElementById("product-container").innerHTML =
              "<p class='text-blue text-center'>No products found</p>";
            return;
          }
          let productHTML = "";
          products.forEach((product) => {
            const imageUrl =
              product.image &&
              product.image.startsWith("https://res.cloudinary.com")
                ? product.image
                : "../assets/images/placeholder.jpg";
            console.log(`Product: ${product.name}, Image URL: ${imageUrl}`);
            productHTML += `
          <div class="flex flex-col items-start max-w-[340px]">
            <div class="w-[290px] md:w-[330px] h-[290px] md:h-[330px] rounded-[20px] bg-white flex items-center justify-center">
              <img src="${imageUrl}" alt="${
              product.name
            }" class="w-[250px] md:w-[290px] object-contain" loading="lazy" onerror="this.src='../assets/images/placeholder.jpg'; console.log('Failed to load: ${imageUrl}')"/>
            </div>
            <h4 class="font-bold text-[20px] md:text-[24px] text-blue mt-4">${
              product.name
            }</h4>
            <p class="text-orange text-[20px] md:text-[25px]">â‚¦${parseFloat(
              product.price
            ).toLocaleString()}</p>
            <button onclick="addToCart('${product._id}', '${product.name}', '${
              product.price
            }', '${product.image}', '${
              product.description
            }')" class="bg-orange text-[14px] md:text-[16px] font-bold text-blue w-24 h-10 md:w-32 md:h-12 rounded-md mt-2">
              Buy Now
            </button>
          </div>
        `;
          });
          document.getElementById("product-container").innerHTML = productHTML;
          updateCartCount();
        } catch (error) {
          console.error("Fetch error:", error);
          document.getElementById("product-container").innerHTML =
            "<p class='text-red-500 text-center'>Failed to load products.</p>";
        } finally {
          document.getElementById("loading").style.display = "none";
        }
      }

      function addToCart(
        productId,
        productName,
        productPrice,
        productImage,
        productDescription
      ) {
        const imageUrl =
          productImage && productImage.startsWith("https://res.cloudinary.com")
            ? productImage
            : "../assets/images/placeholder.jpg";
        console.log(`Adding to cart: ${productName}, Image: ${imageUrl}`);
        const product = {
          id: productId,
          name: productName,
          price: parseFloat(productPrice),
          image: imageUrl,
          description: productDescription,
        };
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart = cart.filter((item) => item.id !== productId);
        cart.push({ ...product, quantity: 1 });
        localStorage.setItem("cart", JSON.stringify(cart));
        localStorage.setItem("selectedProduct", JSON.stringify(product));
        window.location.href = "/product-details.html";
      }

      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce(
          (sum, item) => sum + (item.quantity || 1),
          0
        );
        document.getElementById("cart-count").textContent = totalItems;
        document.getElementById("floating-cart-count").textContent = totalItems;

        const cartPreview = document.getElementById("cart-preview");
        const cartTotal = document.getElementById("cart-total");
        cartPreview.innerHTML = "";
        let totalPrice = 0;
        if (cart.length === 0) {
          cartPreview.innerHTML =
            "<p class='text-white text-sm'>Cart is empty</p>";
        } else {
          cart.forEach((item) => {
            const itemTotal = item.price * (item.quantity || 1);
            totalPrice += itemTotal;
            const imageUrl =
              item.image && item.image.startsWith("https://res.cloudinary.com")
                ? item.image
                : "../assets/images/placeholder.jpg";
            cartPreview.innerHTML += `
          <div class="flex items-center gap-2">
            <img src="${imageUrl}" alt="${
              item.name
            }" class="w-8 h-8 object-contain rounded" loading="lazy" onerror="this.src='../assets/images/placeholder.jpg'" />
            <div class="flex-1">
              <p class="text-white text-sm">${item.name} (x${
              item.quantity || 1
            })</p>
              <p class="text-[#FBB610] text-xs">â‚¦${itemTotal.toLocaleString()}</p>
            </div>
          </div>
        `;
          });
        }
        cartTotal.textContent = `â‚¦${totalPrice.toLocaleString()}`;
      }

      document.getElementById("cart-toggle").addEventListener("click", () => {
        const dropdown = document.getElementById("cart-dropdown");
        dropdown.classList.toggle("hidden");
      });

      fetchProducts();
    </script>

    <script src="../assets/js/script.js"></script>
  </body>
</html>
