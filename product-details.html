<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./assets/css/input.css" rel="stylesheet" />
    <link href="./assets/css/output.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <title>SOLAR PRODUCT SALES</title>
    <style>
      @media (min-width: 768px) {
        .grid-template-columns {
          grid-template-columns: 1fr 2fr;
        }
      }
    </style>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
    ></script>
  </head>

  <body class="max-w-[1280px] mx-auto">
    <header
      class="top-0 left-0 sticky padding-inline flex items-center py-3 justify-between w-full bg-[#002347] md:border-b-0.5 border-custom-blue backdrop-blur-61.5"
    >
      <a href="/">
        <img src="./assets/images/logo.png" class="w-[126px] h-12" alt="logo" />
      </a>
      <nav id="menu" class="hidden md:flex relative">
        <ul class="text-white flex flex-row gap-8">
          <li><a href="/" class="text-sm font-normal">Home</a></li>
          <li>
            <a href="/about.html" class="text-[12px] font-normal">About us</a>
          </li>
          <li>
            <a href="#" class="text-orange text-[12px] font-normal">Service</a>
          </li>
          <li>
            <a href="#contact" class="text-[12px] font-normal">Contact</a>
          </li>
        </ul>
        <span
          id="cart-count"
          class="absolute -top-2 -right-4 bg-orange text-blue rounded-full w-5 h-5 flex items-center justify-center text-xs"
          >0</span
        >
      </nav>
    </header>

    <section
      class="padding-inline grid grid-cols-1 grid-template-columns gap-5 items-center py-3 w-full"
    >
      <div
        class="w-[350px] md:w-[400px] h-[350px] md:h-[400px] rounded-[20px] bg-white flex items-center justify-center"
      >
        <img
          id="product-image"
          src="./assets/images/solar-product1.png"
          alt=""
          class="px-4 w-[300px] md:w-[300px] object-contain"
        />
      </div>
      <div class="flex flex-col gap-5 text-white">
        <div class="flex flex-col gap-2">
          <h2 id="product-price" class="font-semibold text-[32px]"></h2>
          <h2 id="product-name" class="font-semibold text-[24px]"></h2>
          <p id="product-description" class="font-normal text-base"></p>
        </div>
        <div class="grid grid-cols-1 grid-template-columns gap-10">
          <button
            id="quantity-control"
            class="bg-[#FBB610] font-bold text-[16px] text-blue py-2 w-full px-4 rounded flex justify-between"
          >
            <span id="decrease" class="w-6 border border-black rounded-[10px]"
              >-</span
            >
            <span id="quantity">1</span>
            <span id="increase" class="w-6 border border-black rounded-[10px]"
              >+</span
            >
          </button>
          <button
            id="buy-now"
            class="bg-[#FBB610] font-bold text-[16px] text-blue py-2 w-full px-4 rounded"
          >
            Buy Now
          </button>
        </div>
        <button
          id="add-to-cart"
          class="py-3 w-[207px] rounded-[5px] flex justify-around border items-center text-[#FBB610] border-[#FBB610] font-bold text-[14px]"
        >
          <i class="bx bx-cart-add"></i><span>Add to Cart +</span>
        </button>
      </div>
    </section>

    <footer class="padding-inline flex flex-col gap-6 md:gap-12 pt-10 mb-8">
      <img src="./assets/images/logo.png" class="w-24 md:w-32" alt="" />
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <div class="text-white gap-5 flex flex-col">
          <div class="flex flex-col gap-4">
            <h4 class="font-semibold text-[16px] md:text-[20px]">
              Contact Info
            </h4>
            <p class="font-normal text-[12px] md:text-[16px]">
              You can get in touch with us on any of there platforms
            </p>
          </div>
          <div class="flex flex-col gap-4">
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-facebook-square"
              ></i>
              <span>Facebook: Power from the other side</span>
            </p>
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-instagram-alt"
              ></i>
              <span>Instagram: @pfos_Solar</span>
            </p>
            <p class="flex gap-3 items-center text-[14px] md:text-[16px]">
              <i
                class="text-[#B0CFEF] text-[16px] md:text-[20px] bx bxl-whatsapp-square"
              ></i>
              <span>WhatsApp: +234 903 276 9065</span>
            </p>
          </div>
        </div>
        <div class="text-white gap-3 flex flex-col">
          <h4 class="font-semibold text-lg md:text-xl text-white">
            Send Quick Message
          </h4>
          <form
            id="contact-form"
            action=""
            method="post"
            class="flex flex-col gap-3"
          >
            <div class="flex flex-col md:flex-row gap-3">
              <div class="mb-4">
                <input
                  type="text"
                  name="name"
                  id="name"
                  placeholder="Name"
                  class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
                />
              </div>
              <div class="mb-4">
                <input
                  type="email"
                  name="email"
                  id="email"
                  placeholder="Email"
                  class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
                />
              </div>
            </div>
            <div class="mb-4">
              <textarea
                name="message"
                id="message"
                placeholder="Message"
                class="w-full py-3 px-7 rounded bg-[#002347] text-white border border-[#B0CFEF]"
                rows="4"
              ></textarea>
            </div>
            <button
              type="submit"
              class="w-full p-3 rounded bg-[#B0CFEF] text-blue font-semibold hover:bg-blue-700"
            >
              SEND
            </button>
          </form>
        </div>
      </div>
    </footer>
    <section
      class="bg-[#011B36] w-full py-8 padding-inline flex justify-center md:justify-end"
    >
      <p class="text-white text-xs md:text-sm">
        PFDOS Enterprise RC: 3334515 C 2020. All Rights Reserved
      </p>
    </section>

    <script>
      window.onload = function () {
        const product = JSON.parse(localStorage.getItem("selectedProduct"));
        if (product) {
          console.log("Selected Product:", product);
          document.getElementById("product-image").src = product.image;
          document.getElementById("product-image").alt = product.name;
          document.getElementById(
            "product-price"
          ).textContent = `₦${product.price}`;
          document.getElementById("product-name").textContent = product.name;
          document.getElementById("product-description").textContent =
            product.description || "No description available.";
          updateCartCount();
        } else {
          console.error("No product found in localStorage.");
          window.location.href = "/";
        }
      };

      let quantity = 1;

      function updateQuantityDisplay() {
        document.getElementById("quantity").textContent = quantity;
      }

      function addProductToCart(product, qty) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        const existingProductIndex = cart.findIndex(
          (item) => item.id === product.id
        );
        if (existingProductIndex > -1) {
          cart[existingProductIndex].quantity =
            (cart[existingProductIndex].quantity || 1) + qty;
        } else {
          product.quantity = qty;
          cart.push(product);
        }
        localStorage.setItem("cart", JSON.stringify(cart));
        updateCartCount();
      }

      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce(
          (sum, item) => sum + (item.quantity || 1),
          0
        );
        document.getElementById("cart-count").textContent = totalItems;
      }

      document.getElementById("decrease").addEventListener("click", () => {
        if (quantity > 1) {
          quantity--;
          updateQuantityDisplay();
        }
      });

      document.getElementById("increase").addEventListener("click", () => {
        quantity++;
        updateQuantityDisplay();
      });

      document.getElementById("add-to-cart").addEventListener("click", () => {
        const product = JSON.parse(localStorage.getItem("selectedProduct"));
        if (product) {
          addProductToCart(product, quantity);
          console.log(`${product.name} (x${quantity}) added to cart`);
        }
      });

      document.getElementById("buy-now").addEventListener("click", () => {
        const product = JSON.parse(localStorage.getItem("selectedProduct"));
        if (product) {
          // Only add to cart if it’s not already there
          let cart = JSON.parse(localStorage.getItem("cart")) || [];
          const existingProductIndex = cart.findIndex(
            (item) => item.id === product.id
          );
          if (existingProductIndex === -1) {
            addProductToCart(product, quantity); // Add only if not in cart
          }
          window.location.href = "./checkout.html";
        }
      });
    </script>

    <script type="text/javascript">
      document
        .getElementById("quickMessageForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const name = document.getElementById("name").value.trim();
          const email = document.getElementById("email").value.trim();
          const message = document.getElementById("message").value.trim();

          const showNotification = (message, isSuccess = true) => {
            const notification = document.getElementById("form-notification");
            if (!notification) {
              console.error("Notification element not found.");
              return;
            }
            notification.textContent = message;
            notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg transition-opacity duration-300 ${
              isSuccess ? "bg-green-500 text-white" : "bg-red-500 text-white"
            }`;
            notification.classList.remove("hidden");
            notification.classList.add("show");
            setTimeout(() => {
              notification.classList.remove("show");
              notification.classList.add("hidden");
            }, 3000);
          };

          if (!name || !email || !message) {
            showNotification("All fields are required!", false);
            return;
          }

          try {
            const url = "https://pfos-backend.vercel.app/api/messages";
            console.log("Sending request to:", url);
            console.log("Method:", "POST");
            console.log("Body:", JSON.stringify({ name, email, message }));
            console.log("Page URL:", window.location.href); // Log current page

            const response = await fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ name, email, message }),
            });

            console.log("Response status:", response.status);
            console.log("Response headers:", [...response.headers.entries()]);
            const data = await response.json();
            console.log("Response data:", data);

            if (!response.ok) {
              throw new Error(data.error || "Failed to send message");
            }

            showNotification("Message sent successfully!");
            document.getElementById("quickMessageForm").reset();
          } catch (error) {
            showNotification(
              "Failed to send message. Please try again.",
              false
            );
            console.error("Error:", error);
          }
        });
    </script>

    <script src="./assets/js/script.js"></script>
  </body>
</html>
